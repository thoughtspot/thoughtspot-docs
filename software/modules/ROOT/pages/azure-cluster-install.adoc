= Install ThoughtSpot clusters in Azure
:last_updated: 2/27/2020
:linkattrs:
Learn how to install ThoughtSpot clusters in Azure.

== Prerequisites

Before you can install your ThoughtSpot clusters in Azure, complete these prerequisites.

. *Review configuration options* Refer to xref:configuration-options-azure.adoc[Azure configuration options] for detailed instance specs.
. *Create the instance* Refer to xref:launch-an-instance-azure.adoc[Set up Azure for ThoughtSpot] to create and launch your instance.
. *Review required ports* Refer to xref:firewall-ports.adoc[Network Policies] to view the required ports for successful operation of ThoughtSpot.
. *Configure nodes* Refer to xref:installing-azure.adoc[Configure ThoughtSpot nodes in Azure] to configure your nodes.

[#cluster-install]
== Install ThoughtSpot Software

Install the cluster using the ThoughtSpot software release bundle.
The estimated installation time is one hour.
Follow the steps in this checklist.

[cols="5%,95%"]
|===
| &#10063;
| <<cluster-step-1,Step 1: Run the installer>>

| &#10063;
| <<cluster-step-2,Step 2: Check cluster health>>

| &#10063;
| <<cluster-step-3,Step 3: Finalize installation>>
|===

Refer to your welcome letter from ThoughtSpot to find the link to download the release bundle.
If you do not have a link, open a support ticket with xref:contact.adoc[ThoughtSpot Support] to request access to the release bundle.

[#cluster-step-1]
=== Step 1: Run the installer

. Copy the downloaded release bundle to `/export/sdc1/TS_TASKS/install` using the following command:
+
[source,console]
----
 $ scp <release-number>.tar.gz admin@<hostname>:/export/sdc1/TS_TASKS/install/<file-name>
----
+
Note the following parameters:

** `release-number` is the release number of your ThoughtSpot instance, such as 5.3, 6.0, and so on.
** `hostname` is your specific hostname.
** `file-name` is the name of the tarball file on your local computer.

+
NOTE: You can use another secure copy method, if you prefer a method other than the `scp` command.

. Alternatively, use `tscli fileserver download-release` to download the release bundle.
+
You must xref:tscli-command-ref.adoc#tscli-fileserver[configure the fileserver] by running `tscli fileserver configure` before you can download the release.
+
[source,console]
----
 $ tscli fileserver download-release <release-number> --user <username> --out <release-location>
----
+
Note the following parameters:

 ** `release-number` is the release number of your ThoughtSpot instance, such as 5.3, 5.3.1, 6.0, and so on.
 ** `username` is the username for the fileserver that you set up earlier, when configuring the fileserver.
 ** `release-location` is the location path of the release bundle on your local machine.
For example, `/export/sdc1/TS_TASKS/install/6.0.tar.gz`.

. Verify the checksum to ensure you have the correct release.
+
Run `md5sum -c <release-number>.tar.gz.MD5checksum`.
+
[source,console]
----
 $ md5sum -c <release-number>.tar.gz.MD5checksum
----
+
Your output says `ok` if you have the correct release.

. Launch a https://linux.die.net/man/1/screen[screen,window=_blank] session.
Use screen to ensure that your installation does not stop if you lose network connectivity.
+
[source,console]
----
 $ screen -S DEPLOYMENT
----

. Manually update tscli.
+
[source,console]
----
 $ tar -C /usr/local/scaligent -zxpf <release-number>.tar.gz './bin/tscli'
----

. Create the cluster.
+
Run `tscli cluster create` to create the cluster.
+
[source,console]
----
 $ tscli cluster create <release-number>.tar.gz
----

. Edit the output with your specific cluster information.
+
For more information on this process, refer to xref:cluster-create.adoc[Using the tscli cluster create command] and xref:parameters-cluster-create.adoc[Parameters of the `cluster create` command].
+
The cluster installer automatically reboots all the nodes after a successful install.
The `firewalld` service automatically turns on.
At this time, the system is rebooting, which may take approximately 15 minutes.

. Log in to any node to check the current cluster status:
+
[source,console]
----
 $ tscli cluster status
----

[#cluster-step-2]
=== Step 2: Check cluster health

After the cluster installs, check its status using the `tscli cluster status` command.

Your output may look similar to the following:

[source,console]
----
$ tscli cluster status
----
----
Cluster: RUNNING
Cluster name    : thoughtspot
Cluster id      : 1234X11111
Number of nodes : 3
Release         : 6.0
Last update     = Wed Oct 16 02:24:18 2019
Heterogeneous Cluster : False
Storage Type    : HDFS

Database: READY
Number of tables in READY state: 2185
Number of tables in OFFLINE state: 0
Number of tables in INPROGRESS state: 0
Number of tables in STALE state: 0
Number of tables in ERROR state: 0

Search Engine: READY
Has pending tables. Pending time = 1601679ms
Number of tables in KNOWN_TABLES state: 1934
Number of tables in READY state: 1928
Number of tables in WILL_REMOVE state: 0
Number of tables in BUILDING_AND_NOT_SERVING state: 0
Number of tables in BUILDING_AND_SERVING state: 128
Number of tables in WILL_NOT_INDEX state: 0
----

Ensure that the cluster is `RUNNING` and that the Database and Search Engine are `READY`.

[source,console]
----
 $ tscli cluster check
----
----
 Connecting to hosts...
 [Wed Jan  8 23:15:47 2020] START Diagnosing ssh
 [Wed Jan  8 23:15:47 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:15:47 2020] START Diagnosing connection
 [Wed Jan  8 23:15:47 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:15:47 2020] START Diagnosing zookeeper
 [Wed Jan  8 23:15:47 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:15:47 2020] START Diagnosing sage
 [Wed Jan  8 23:15:48 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:15:48 2020] START Diagnosing timezone
 [Wed Jan  8 23:15:48 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:15:48 2020] START Diagnosing disk
 [Wed Jan  8 23:15:48 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:15:48 2020] START Diagnosing cassandra
 [Wed Jan  8 23:15:48 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:15:48 2020] START Diagnosing hdfs
 [Wed Jan  8 23:16:02 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:16:02 2020] START Diagnosing orion-oreo
 [Wed Jan  8 23:16:02 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:16:02 2020] START Diagnosing memcheck
 [Wed Jan  8 23:16:02 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:16:02 2020] START Diagnosing ntp
 [Wed Jan  8 23:16:08 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:16:08 2020] START Diagnosing trace_vault
 [Wed Jan  8 23:16:09 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:16:09 2020] START Diagnosing postgres
 [Wed Jan  8 23:16:11 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:16:11 2020] START Diagnosing disk-health
 [Wed Jan  8 23:16:11 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:16:11 2020] START Diagnosing falcon
 [Wed Jan  8 23:16:12 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:16:12 2020] START Diagnosing orion-cgroups
 [Wed Jan  8 23:16:12 2020] SUCCESS
 ################################################################################
 [Wed Jan  8 23:16:12 2020] START Diagnosing callosum
 /usr/lib/python2.7/site-packages/urllib3/connectionpool.py:852: InsecureRequestWarning: Unverified HTTPS request is being made. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.adoc#ssl-warnings
   InsecureRequestWarning)
 [Wed Jan  8 23:16:12 2020] SUCCESS
 ################################################################################
----
Your output may look something like the above.
Ensure that all diagnostics show `SUCCESS`.

WARNING: If `tscli cluster check` returns an error, it may suggest you run `tscli storage gc` to resolve the issue.
If you run `tscli storage gc`, note that it restarts your cluster.

[#cluster-step-3]
=== Step 3: Finalize installation

After the cluster status changes to `READY`, sign in to ThoughtSpot on your browser.
Follow these steps:

. Start a browser from your computer.
. Enter your secure IP information on the address line.
+
----
 https://<IP-address>
----

. If you don't have a security certificate for ThoughtSpot, you must bypass the security warning:

 ** Click *Advanced*
 ** Click *Proceed*
. The ThoughtSpot sign-in page appears.
. In the <<ts-login,ThoughtSpot sign-in window>>, enter admin credentials, and click *Sign in*.
ThoughtSpot recommends changing the default admin password.

[#ts-login]
image:ts-login-page.png[ThoughtSpot's sign-in window]
// {% include image.adoc file="ts-login-page.png" title="ThoughtSpot's sign-in window" alt="Sign in to ThoughtSpot. Enter Username, Password, and click Sign in. You may select the Remember me option." caption="ThoughtSpot's sign-in window" %}

== Lean configuration

*(For use with thin provisioning only)* If you have a xref:cloud.adoc#use-small-and-medium-instance-types-when-applicable[small or medium instance type], with less than 100GB of data, advanced lean configuration is required before loading any data into ThoughtSpot.
After installing the cluster, contact xref:contact.adoc[ThoughtSpot Support] for assistance with this configuration.

== Additional resources

As you develop your expertise in Azure cluster installation, we recommend the following ThoughtSpot U course:

* https://training.thoughtspot.com/create-upgrade-patch-a-thoughtspot-cluster/430642[Create a Cluster,window=_blank]

See other training resources at
https://training.thoughtspot.com/[ThoughtSpot U,window=_blank]

'''
> **Related information**
>
> Use these references for successful installation and administration of ThoughtSpot:
>
> * xref:nodesconfig-example.adoc[The nodes.config file]
> * xref:parameters-nodesconfig.adoc[Parameters of the nodes.config file]
> * xref:cluster-create.adoc[Using the tscli cluster create command]
> * xref:parameters-cluster-create.adoc[Parameters of the cluster create command]
> * xref:contact.adoc[Contact Support]
