= Set up ThoughtSpot in GCP
:last_updated: 8/6/2021
:linkattrs:
:experimental:

Set up your GCP virtual machines.


'''
> **ThoughtSpot Training**
>
> * For best results in setting up ThoughtSpot on GCP, we recommend that you take the following ThoughtSpot U course: https://training.thoughtspot.com/node-network-configuration/430736[Node Configuration: GCP^].
> * See other training resources at https://training.thoughtspot.com/[ThoughtSpot U^].

'''

After you determine your configuration options, set up your virtual machines (VMs).
ThoughtSpot will share the ThoughtSpot base image for booting the VMs and some other aspects of system setup with you on the https://console.cloud.google.com[GCP platform^].

ThoughtSpot uses a custom image to populate VMs in GCP.
To find the ThoughtSpot custom image, refer to step 13 in the xref:instance-create[create an instance] section.

Ask your ThoughtSpot contact for access to this image.
We need the Google account/email ID of the individual who will be signed into your organization's GCP console.
We will share ThoughtSpot's GCP project with them so they can use the contained boot disk image to create ThoughtSpot VMs.

This guide explains how to deploy ThoughtSpot on GCP, using ThoughtSpot's CentOS-based image.
You can also deploy ThoughtSpot on GCP using Red Hat Enterprise Linux (RHEL) or Oracle Enterprise Linux (OEL), allowing you to run ThoughtSpot on an RHEL 7.8 or 7.9 or OEL 7.9 image that your organization manages internally.
To install ThoughtSpot using RHEL or OEL, refer to the xref:rhel.adoc[RHEL and OEL deployment guide].

Before you can create a ThoughtSpot cluster, you must set up your VMs.
Use the Google Compute Engine (GCP) platform to create and run VMs.

The following topics walk you through this process.

== Prerequisites

Before you begin setting up ThoughtSpot, complete the following tasks:

[cols="5,~",grid=none,frame=none]
|===
| &#10063; | Ensure that your *Network Service Tier* on the https://console.cloud.google.com/[Google Cloud Console^] is set to *Premium* for the best performance of all your VMs.
| &#10063; | A ThoughtSpot cluster requires 10 Gb/s bandwidth (or better) between any two nodes. You must ensure this _before_ creating a new cluster.
| &#10063; | Download and fill out the ThoughtSpot link:{attachmentsdir}/site-survey.pdf[Site survey^] to have a quick reference for your networking information. Ask your network administrator if you need help filling out the site survey.
|===

[#bucket-setup]
== Setting up your Google Cloud Storage (GCS) bucket

If you are going to deploy your cluster using the GCS-storage option, you must set up that bucket before you set up your cluster.
Contact https://community.thoughtspot.com/customers/s/contactsupport[ThoughtSpot Support^] to find out if your specific cluster size will benefit from the GCS storage option.
If you are not using GCS, skip this step and <<instance-create,create an instance>>.

. Sign in to the https://console.cloud.google.com/[Google Cloud Console^].
. Go to the *Storage* dashboard from the navigation bar on the side of your screen.
. Click *CREATE BUCKET* on the top menu bar.
. Enter a name for your bucket, and click *CONTINUE*.
. For location type, select *Region*.
. Use the Location drop-down menu to select the region where you are going to set up your instance.
. Click *CONTINUE*.
. For default storage class, select *Standard*.
. Click *CONTINUE*.
. Under *Access Control*, select *Uniform* to ensure uniform access to all objects in the storage bucket.
. Click *CONTINUE*.
. Do not edit the advanced settings.
+
Leave Encryption set to *Google-managed key* and do not set a retention policy.
. Click *CREATE*.

When you create your instance, make sure you set Storage to *Read Write* access.

[#instance-create]
== Create an instance

. Sign in to the https://console.cloud.google.com/[Google Cloud Console].
. Click *Select a Project* from the top bar.
. Under *Select From*, pick your company's project.
. Go to the Compute Engine dashboard.
+
image::gcp-computeenginedash.png[Go to the Compute Engine Dashboard]

. Select *VM instances* on the left panel.
. Click the *+* icon from the top menu bar to create an instance.
. Provide a name for the instance.
. Select the region you are creating the instance in.
. Select the zone you are creating your region in.
. Under *Machine type*, select *custom*.
. Select the number of vCPU cores you need.
+
Refer to xref:gcp-configuration-options.adoc[ThoughtSpot GCP instance types] to determine the number of vCPU cores your cluster needs.
. Specify your memory requirements and CPU platform.
+
Refer to xref:gcp-configuration-options.adoc[ThoughtSpot GCP instance types] to determine the memory your cluster needs.
+
Your configuration may look something like the following, but with your specific information.
+
Cores:: 64 vCPU
Memory:: 416 GB
CPU platform:: Automatic, or select either one of the preferred CPU platforms, `Intel Skylake` or `Intel Broadwell`, if available.
+
image::gcp-machineconfig.png[Specify machine configuration]
+
image::gcp-3-preferred-CPUs.png[Preferred CPU platforms]

. Configure the Boot disk.
.. Scroll down to the *Boot disk* section and click *Change*.
+
image::gcp-4-change-boot-disk.png[Change boot disk]
.. Click *Custom Images* from the options under *Boot disk*.
.. Select *ThoughtSpot-images* under *Show images from*.
.. Select one of the ThoughtSpot base images.
+
Under the name of the image, you can see when it was created. ThoughtSpot should have directly sent you an image to use. If so, use that image.
+
image::gcp-selecttsimage.png[Select the latest ThoughtSpot image]
+
The image you should use depend on your release number.
+
Release Number 7.1:: thoughtspot-image-20210402-71f6832a800-prod

ThoughtSpot updates the base images with patches and enhancements. If more than one image is available, select the latest one by looking at the dates of creation. Each image works; however, we recommend using the latest image because it typically contains the most recent security and maintenance patches. xref:support-contact.adoc[Contact ThoughtSpot Support] if you are unsure which image to use.

.. Configure the boot disk as follows:
+
Image::
 ThoughtSpot
Boot disk type::
  SSD
Size (GB):: 250

.. Click *Select* to save the boot disk configuration.

. Back on the main configuration page, click to expand the advanced configuration options (*Management, security, disks, networking, sole tenancy*).
+
image::gcp-6-save-boot-disk-expand-mgmt.png[Advanced configuration options]

. Attach two 1 TB SSD drives for data storage.
Refer to xref:gcp-configuration-options.adoc#vms-with-persistent-disk-only-storage-in-memory[SSD-only persistent storage].
If you are using GCS, attach only 1 SSD drive, with 500 GB instead of 1 TB.
Refer to xref:gcp-configuration-options.adoc#vms-with-persistent-disk-and-google-cloud-storage-in-memory[GCS and SSD persistent storage].

.. Click the *Disks* tab, and click *Add new disk*.
+
image::gcp-7-advanced-disk-config.png[Add new disk]
+
Unselect the *Deletion rule*, to prevent potential loss of data if your instance is deleted accidentally.

.. Configure the following settings for each disk.
Refer to xref:gcp-configuration-options.adoc#vms-with-persistent-disk-and-google-cloud-storage-in-memory[ThoughtSpot GCP instance types] to determine the size in GB when you have GCS.
Ensure the disks have read/write access.
+
Type:: SSD persistent disk
Source type:: Blank disk
Size (GB):: 1024
Deletion rule:: select *keep disk*, to prevent potential loss of data if your instance is deleted accidentally
+
image::gcp-8-advanced-blank-disk-config.png[Configure your disk]

. (For use with GCS only) In the Identity and API access section, make sure Service account is set to *Compute Engine default service account*.
Under Access scopes, select *Set access for each API*.
. (For use with GCS only) After you click *Set access for each API*, scroll down to the *Storage* dropdown menu in the Identity and API access section.
Set it to one of the following options:
 ** To use Google Cloud Storage (GCS) as persistent storage for your instance, select *Read Write*.
 ** To only use GCS to load data into ThoughtSpot, select *Read Only*.
. Under *Networking*, customize the network settings as needed.
Use your default VPC settings, if you know them.
Ask your network administrator if you do not know your default VPC settings.
+
Update the network interface with your specific information or create a new one.
+
image::gcp-setnetworkinterface.png[Set your network interface]
+
[cols="5,~",grid=none,frame=none]
|===
| 1. |Add an existing VPC network, or create a new one by clicking *VPC network* from the main menu.
Ensure that this network has a *firewall rule* attached, with the minimum ports required for ThoughtSpot operation open.
Refer to the <<port-requirements,minimum port requirements>>.
See Google's https://cloud.google.com/vpc/docs/using-firewalls[using firewalls] and https://cloud.google.com/vpc/docs/using-vpc[using VPCs] documentation for assistance creating a firewall rule and a VPC network.

| 2. | Set the external IP as either ephemeral or static, depending on your preference.

| 3. |Ensure that *network service tier* is set to *premium*.
|===

. Repeat these steps to create the necessary number of VMs for your cluster.

[#port-requirements]
=== Minimum required ports

Open the following ports between the User/ETL server and ThoughtSpot nodes.
This ensures that the ThoughtSpot processes do not get blocked.
Refer to xref:ports.adoc#required-ports-for-cluster-communication[Network ports] for more information on what ports to open for intracluster operation, so that your clusters can communicate.

The minimum ports needed are:

Port:: 22
  [horizontal]
  Protocol;; SSH
  Service;; Secure Shell access

Port:: 443
  [horizontal]
  Protocol;; HTTPS
  Service;; Secure Web access

Port:: 12345
  [horizontal]
  Protocol;; TCP
  Service;; ODBC and JDBC drivers access


== Prepare the VMs

Before you can install your ThoughtSpot cluster, an administrator must log in to each VM through SSH as user "admin", and complete the following preparation steps:

. Open a terminal application on your machine and ssh into one of your VMs.
+
[source,bash]
----
ssh admin@<VM-IP>
----

. Run `sudo /usr/local/scaligent/bin/prepare_disks.sh`.
+
[source,bash]
----
$ sudo /usr/local/scaligent/bin/prepare_disks.sh
----

. Configure the VM based on the site-survey.
. Repeat this process for each of your VMs.

== Install cluster

To install your ThoughtSpot cluster, complete the installation process outlined in xref:gcp-installing.adoc[Installing ThoughtSpot in GCP].

'''
> **Related information**
>
> * https://cloud.google.com/compute/docs/disks/gcs-buckets[Connecting to Google Cloud Storage buckets]
> * xref:tsload-import-csv.adoc#loading-data-from-a-gcp-gcs-bucket[Loading data from a GCP GCS bucket]
