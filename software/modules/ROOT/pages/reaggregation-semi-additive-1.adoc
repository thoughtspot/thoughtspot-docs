= Reaggregation Scenario 3: Average period value for semi-additive numbers I
:last_updated: 07/30/2021
:experimental:
:linkattrs:
:page-partial:

*Semi-additive* numbers may be aggregated across some, but not all, dimensions.
They commonly apply to specific time positions.
In this scenario, we have daily position values for home loans, and therefore cannot aggregate on the date dimension.

== Valid solution

include::partial$intro-valid-solution.adoc[]

----
average(group_aggregate(sum(loan balance),
                        query_groups() + {date(balance date)},
                        query_filters()))
----

image::avg-period-non-additive-1-1.png[Average period value semi-additive numbers, aggregated result]

== Resolution

. The `sum(loan balance)` function aggregates to the following attributes:
 ** `{date(balance date)}` and `query_groups()`
+
Add additional search columns to this aggregation.
Here, this at the `yearly` level.

 ** `query_filters ( )`
+
Applies any filters entered in the search.
Here, there are no filters.
. The `sum(loan balance)` function returns a result for each row in this virtual table.
. The outer `average()` function reaggregates the final output as a single row for each `year` value.
