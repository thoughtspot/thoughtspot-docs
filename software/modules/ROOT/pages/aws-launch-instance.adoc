= Set up AWS resources for ThoughtSpot
:last_updated: 8/6/2021
:linkattrs:
:experimental:

After you determine your configuration options, you must set up your virtual machines (VMs) in AWS using a ThoughtSpot Amazon Machine Image (AMI).

'''
> **ThoughtSpot Training**
>
> * For best results in setting up ThoughtSpot in AWS, we recommend that you take the following ThoughtSpot U course: https://training.thoughtspot.com/node-network-configuration/484851[Node Configuration: AWS^].
> * See other training resources at https://training.thoughtspot.com/[ThoughtSpot U^].

'''
[#aws-overview]
== Overview of ThoughtSpot setup in AWS

Follow these steps to set up your ThoughtSpot VMs in AWS.

[cols="5,~",grid=none,frame=none]
|===
| &#10063; | xref:ami[1. Get access to ThoughtSpot's AMI].
| &#10063; | xref:ec2-setup[2. Choose a VM instance configuration recommended by ThoughtSpot.]
| &#10063; | xref:s3-bucket-setup[3. Set up your Amazon S3 bucket (optional)]
| &#10063; | xref:aws-ts-setup-cluster[4. Set up your ThoughtSpot cluster in AWS]
| &#10063; | xref:security-groups[5. Configure security groups]
| &#10063; | xref:network-ports[6. Open the required network ports] for communication for the nodes in your cluster and end users.
| &#10063; | xref:prepare-vms[7. Prepare the VMs]
|===

[#prerequisites-ami]
== About the ThoughtSpot AMI

An Amazon Machine image (AMI) is a preconfigured template that provides the information required to launch an instance.
You must specify an AMI when you launch an instance in AWS.

To make deployment easy, the ThoughtSpot AMI includes a custom ThoughtSpot image, with the following components:

* A template for the boot volume for the instance, such as an operating system, an appliance server, and applications.
* Launch permissions that control which AWS accounts can use the AMI to launch instances.
* A block device mapping that specifies the volumes to attach to the instance when it launches.

The ThoughtSpot AMI has specific applications on a CentOS-based image.
The AMI includes the EBS volumes necessary to install ThoughtSpot in AWS.
When you launch an EC2 instance from this image, it automatically sizes and provisions the EBS volumes.
The base AMI includes 200 GB (xvda), 2X400 GB (xvdb), and SSD (gp2).
It contains the maximum number of disks to handle a fully loaded VM.

[#rhel-ami]
=== RHEL or OEL AMI

This guide explains how to deploy ThoughtSpot on AWS, using ThoughtSpot's CentOS-based image.
You can also deploy ThoughtSpot on AWS using Red Hat Enterprise Linux (RHEL) or Oracle Enterprise Linux (OEL), allowing you to run ThoughtSpot on an RHEL 7.8 or 7.9 or OEL 7.9 image that your organization manages internally.
To install ThoughtSpot using RHEL or OEL, choose your own RHEL- or OEL-based image on the AWS console, instead of ThoughtSpot's image, and refer to the xref:rhel.adoc[RHEL and OEL deployment guide] after you launch your virtual machines.

[#al2-ami]
=== Amazon Linux 2 AMI

This guide explains how to deploy ThoughtSpot on AWS, using ThoughtSpot's CentOS-based image.
You can also deploy ThoughtSpot on AWS using Amazon Linux 2, allowing you to run ThoughtSpot on an Amazon Linux 2 image that your organization manages internally.
To install ThoughtSpot using Amazon Linux 2, choose your own Amazon Linux 2-based image on the AWS console, instead of ThoughtSpot's image, and refer to the xref:al2.adoc[Amazon Linux 2 deployment guide] after you launch your virtual machines.

[#prerequisites]
== Prerequisites

To install and launch ThoughtSpot, you must have the following:

[cols="5,~",grid=none,frame=none]
|===
| &#10063; | Familiarity with Linux administration, and a general understanding of cloud deployment models.
| &#10063; | The necessary AWS Identity and Access Management (IAM) users and roles assigned to you to access and deploy the various AWS resources and services as defined in the Required AWS components section that follows.
| &#10063; | Networking information: Download and fill out the ThoughtSpot link:{attachmentsdir}/site-survey.pdf[site survey] to have a quick reference point. Ask your network administrator if you need help filling out the site survey.
|===

For more information about IAM, see: https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html[What Is IAM?^] in Amazon's AWS documentation.

[#aws-required]
=== Required AWS components

You require the following AWS components:

[cols="5,~",grid=none,frame=none]
|===
| &#10063; a| An AWS Virtual Private Cloud (VPC).

An AWS VPC is a virtual network specifically for your AWS account. It exists in all availability zones in your region, but you can specify a local zone for even lower latency. For more details, see https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html[VPCs and Subnets^] in Amazon's AWS documentation.
| &#10063; | A ThoughtSpot AMI. For details, see xref:ami[Choose VM instances].
| &#10063; a| AWS security groups.

For required open ports, see xref:ports.adoc[Network ports].
| &#10063; a| An AWS VM instances.

For instance type recommendations, see xref:aws-configuration-options.adoc#ts-aws-instance-types[ThoughtSpot AWS instance types].
| &#10063; | EBS volumes for data storage.
| &#10063; | If deploying with S3 persistent storage, you must have one S3 bucket for each ThoughtSpot cluster.
|===

[#ami]
== Get access to ThoughtSpot AMI

. Sign in to your https://console.aws.amazon.com/console/home[AWS account^].
. Copy the correct ThoughtSpot public AMI to your AWS region.
Refer to the following information to find the AMI you should use, depending on your release number and when your cluster was created.

=== AMI for clusters created after November 19, 2021

Release Number:: 7.1
AMI Name:: thoughtspot-image-20210405-ec1319de70e-prod
AMI ID:: ami-03767ea7551010ce6
Region:: Oregon
Notes:: The AMI is based in the Oregon region. You may have to temporarily switch to the Oregon region on the AWS website to initiate copying the AMI to the region of your choice. After the copy completes, you can return to your own region.

=== AMI for clusters created before November 19, 2021

Release Number:: 7.1
AMI Name:: thoughtspot-image-20210405-ec1319de70e-prod
AMI ID:: ami-0590a6bd470448a21
Region:: N. California
Notes:: The AMI is based in the N. California region. You may have to temporarily switch to the N. California region on the AWS website to initiate copying the AMI to the region of your choice. After the copy completes, you can return to your own region.

[#ec2-setup]
== Choose VM instances

. Choose the appropriate EC2 instance type: See xref:aws-configuration-options.adoc#ts-aws-instance-types[ThoughtSpot AWS instance types] for help choosing the correct instance type for your cluster.
. Networking requirements: 10 GbE network bandwidth is needed between the VMs.
+
Ensure that you have this bandwidth.
. Ensure that all your VMs are on the same Amazon Virtual Private Cloud (VPC) and subnetwork.
+
This is necessary because VMs that are part of a cluster need to be accessible by each other.
+
Additional external access may be required to bring data in/out of the VMs to your network.
+
Add all nodes in the same placement group.
. Determine the number of EC2 instances you need: Based on the datasets, this number will vary.
+
Refer to xref:aws-configuration-options.adoc#ts-aws-instance-types[ThoughtSpot AWS instance types] for recommended nodes for a given data size.

NOTE: Staging larger datasets (> 50 GB per VM), may require provisioning additional attached EBS volumes that are SSD (gp2).

[#s3-bucket-setup]
== Setting up your Amazon S3 bucket (recommended)

If you are going to deploy your cluster using the S3-storage option, you must set up that bucket before you set up your cluster.
Contact xref:support-contact.adoc[ThoughtSpot Support] to determine if your specific cluster size can benefit from the S3 storage option.

Follow these steps to set up an S3 bucket in AWS.

. On the AWS website, navigate to the S3 service dashboard by clicking *Services*, then *S3*.
. Make sure the selected region in the top-right corner of the dashboard is the same region in which you plan to set up your cluster.
. Click *Create bucket*.
. In the *Name and region* page, enter a name for your bucket.
. Select your region.
. Click *Next*.
. On the *Properties* page, click *Next*.
. On the Configure options page, ensure that *Block _all_ public access* is selected.
. Click *Next*.
. On the Set permissions page, click *Create bucket*.

[#encrypt]
== Encrypting your data at rest

ThoughtSpot makes use of EBS for the data volumes to store persistent data (in the EBS deployment model) and the boot volume (in the EBS and S3 deployment models).
ThoughtSpot recommends that you encrypt your data volumes prior to setting up your ThoughtSpot cluster.
If you are using the S3 persistent storage model, you can encrypt the S3 buckets using SSE-S3 or AWS KMS.

For more information on encryption supported with AWS:

[horizontal]
EBS:: See https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html[Amazon EBS Encryption^] in Amazon's AWS documentation.
S3:: See https://docs.aws.amazon.com/AmazonS3/latest/dev/bucket-encryption.html[Amazon S3 Default Encryption for S3 Buckets^] in Amazon's AWS documentation.

[#aws-ts-setup-cluster]
== Setting up your ThoughtSpot cluster

To set up a ThoughtSpot cluster in AWS, follow these steps:

. On the AWS website, navigate to the EC2 service dashboard by clicking *Services*, then *EC2*.
+
image::navigate_to_ec2_dashboard.png[]

. Make sure your selected region is correct in the top-right corner of the dashboard.
If not, select your region.
Let ThoughtSpot support know if you change your region.
. Start the process of launching a VM by clicking *Launch Instance*.
+
image::launch_instance.png[]

. In the *My AMIs* tab under *1.
Choose AMI*, search *ThoughtSpot* to find the ThoughtSpot AMI.
. Click *Select*.
Ensure that you select the ThoughtSpot AMI listed in xref:ami[Get access to ThoughtSpot AMI], which you entered earlier in this process.
+
image::aws-choose-ami.png[Select the ThoughtSpot AMI]

. On the *Choose an Instance Type* page, select a ThoughtSpot-supported instance type. See xref:aws-configuration-options.adoc#ts-aws-instance-types[ThoughtSpot AWS instance types].
. Click *Next: Configure Instance Details*.
. Configure the instances by choosing the number of EC2 instances you need.
The instances must be on the same VPC and subnetwork.
ThoughtSpot sets up the instances to be in the same ThoughtSpot cluster.
+
*S3 storage setting*: If you are going to use the S3 storage option, ThoughtSpot recommends that you restrict access to a specific S3 bucket.
Create a new IAM role that provides read/write access to the specific bucket, and select it.
For details on that, click *Create new IAM role*.
+
*AWS Systems Manager Agent*: If you plan to use the https://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-agent.html[AWS SSM agent^] as an alternative to SSH, create a new IAM role with an SSM policy to grant AWS SSM permission to perform actions on your instances.
Refer to https://docs.aws.amazon.com/systems-manager/latest/userguide/setup-instance-profile.html[Create an IAM instance profile for Systems Manager^].

. Click *Next: Add Storage*.
Add the required storage based on your instance type (either EBS volumes or S3), and the amount of data you are deploying.
For specific storage requirements, refer to xref:aws-configuration-options.adoc[ThoughtSpot AWS instance types].
+
image::aws-add-storage.png[Add storage volumes]
+
[horizontal]
1:: Click *Add new volume*.
2:: Specify the type of storage, either EBS or S3.
3:: Specify the size of the volume.
4:: Ensure that you leave *Delete on termination* unchecked, to prevent potential loss of data if the VM is accidentally terminated.

. When you are done modifying the storage size, click *Next: Add Tags*.
. Set a name for tagging your instances.
This tag allows you to identify your instance more easily.

[#security-groups]
== Configure security groups

. Click *Next: Configure Security Group*.
. Select an existing security group to attach new security groups to so that it meets the security requirements for ThoughtSpot.
+
TIP: Security settings for ThoughtSpot
+
** The VMs must have intragroup security: every VM in a cluster must be accessible to all clusters. For easier configuration, ThoughtSpot recommends that you enable full access between VMs in a cluster.
** You must open more ports on the VM to provide data staging capabilities to your network. Check ThoughtSpot's Network ports documentation to determine the minimum required ports you must open for your ThoughtSpot appliance.
+
[#network-ports]
Refer to xref:ports.adoc[Network ports].

. Click *Review and Launch*.
. After you have reviewed your instance launch details, click *Launch*.
. Choose a key pair. A key pair consists of a public and private key used to encrypt and decrypt login information. If you don't have a key pair, you must create one. Without a key pair, you cannot SSH into the AWS instance later.
. Click *Launch Instances*. Wait a few minutes for it to fully start up. After it starts, it appears on the EC2 console.

[#prepare-vms]
== Prepare the VMs

Before installing a ThoughtSpot cluster, an administrator must xref:aws-prepare-vms.adoc[prepare the VMs].
