= Back up and Restore an AWS cluster using S3
:last_updated: 7/13/2020
:linkattrs:
:experimental:
:description: Learn how to back up or restore your ThoughtSpot cluster hosted in AWS using an S3 bucket.

Learn how to back up or restore your ThoughtSpot cluster hosted in AWS using an S3 bucket.

It is recommended to use a bucket in the same region as your cluster.
By doing this, you avoid additional cross-region data transfer costs.

== Backing up to an Amazon S3 bucket

You can back up your cluster to an S3 bucket either <<manual-backup,manually>> or <<periodic-backup,periodically>>.

[#manual-backup]
To manually back up your cluster to an S3 bucket, use the ThoughtSpot tscli:

. Log in to the Linux shell of your cluster using SSH.
+
[source,console]
----
 $ ssh admin@<cluster-IP>
----

. Run the backup command using the following syntax:
+
`tscli backup create --storage_type=s3a <SNAPSHOT NAME> <PATH TO BACKUP> --bucket_name=<BUCKET NAME>`
+
Example:
+
[source,console]
----
 $ tscli backup create --storage_type=s3a snapshot_1 my_backup001 --bucket_name=my_bucket
----

[#periodic-backup]
To periodically back up your cluster to an S3 bucket using a backup policy, use the ThoughtSpot tscli:

. Log in to the Linux shell of your cluster using SSH.
+
[source,console]
----
 $ ssh admin@<cluster-IP>
----

. Run the backup policy command:
+
[source,console]
----
 $ tscli backup-policy create
----

. The command opens a `vi` editor you can use to configure the backup policy, which has the following syntax:
+
[source]
----
 name: <backup-name>
 param {
   mode: [FULL | LIGHT | DATALESS]
   type: STANDALONE
 }
 schedule {
   period {
     number: <number-in-integer-format>
     unit: [MINUTE | HOUR | DAY]
   }
   retention_policy {
     bucket {
       time {
         number: <number-in-integer-format>
         unit: [MINUTE | HOUR | DAY]
       }
       capacity: <number-in-integer-format>
     }
   }
   offset_minutes_from_sunday_midnight: <number-in-integer-format>
 }
 directory: <directory-name>
 storage_type: S3
 enabled: true
 bucket_name: <your-S3-bucket-name>
----
+
You must specify `S3` for the `storage_type`.
Refer to xref:backup-configure-schedule.adoc[Configure periodic backups] for more information.

== Restoring from an Amazon S3 bucket

To restore your cluster from an S3 bucket, use the ThoughtSpot tscli:

. Log in to the Linux shell of your cluster using SSH.
+
[source,console]
----
 $ ssh admin@<cluster-IP>
----

. Run the restore command using the following syntax:
+
`tscli cluster restore <PATH TO BACKUP ON CLOUD> --enable_cloud_storage=s3a`
+
Example:
+
[source,console]
----
 $ tscli cluster restore s3://bucket0001/backup/my_backup001 --enable_cloud_storage=s3a
----

'''
> **Related information**
>
> * xref:aws-launch-instance.adoc[Set up AWS resources for ThoughtSpot]
> * xref:aws-prepare-vms.adoc[Prepare AWS VMs for ThoughtSpot]
> * xref:aws-installing.adoc[Configure ThoughtSpot nodes in AWS]
> * xref:aws-cluster-install.adoc[Install ThoughtSpot clusters in AWS]
> * xref:ha-aws-efs.adoc[Set up high availability]
