= Set the relay host for SMTP
:last_updated: 7/23/2021
:page-aliases: /admin/setup/set-up-relay-host.adoc
:experimental:
:linkattrs:

ThoughtSpot uses email to send critical notifications to ThoughtSpot Support. A relay host for SMTP traffic routes the alert and notification emails coming from ThoughtSpot through an SMTP email server.

You can configure the relay host <<tscli,using tscli>> or <<admin-portal,through the Admin Console>>.

'''
> **ThoughtSpot Training**
>
> * For best results in setting up ThoughtSpot emails and alerts, we recommend that you take the following ThoughtSpot U course: https://training.thoughtspot.com/emails-alerts[Email and Alert Setup^].
> * See other training resources at https://training.thoughtspot.com/[ThoughtSpot U^].

'''

[#tscli]
== Configure using tscli

Set up SMTP rules to send critical email notifications to ThoughtSpot Support.

=== Set up the relay Host

To set up a relay host:

. Log in to the Linux shell using SSH.
. Issue the setup command, providing the IP address of the relay host:
+
On ThoughtSpot release 6.1.1 and later, or on release 6.0.5, you can specify a custom port to connect to the relay host.
If you do not specify a port, the system uses the default recommended port, port 25.
Use a custom port if port 25 is blocked in your environment.
+
To use the default port, run the setup command:
+
[source,bash]
----
$ tscli smtp set-relayhost <IP_address>
----
+
To use a custom port instead of port 25, run the setup command, specifying the port you want to use:
+
[source,bash]
----
 $ tscli smtp set-relayhost <IP_address>:<custom_port>
----
+
If you are on 6.1 rather than 6.1.1, or an earlier version than 6.0.5, contact xref:support-contact.adoc[ThoughtSpot Support] to use a custom port.

. Verify your settings:
+
[source,bash]
----
 $ tscli smtp show-relayhost
----

. Verify that email is working.

=== Configure an email to send alerts

. Log in to the Linux shell using SSH.

. Specify the domain of the email address you would like emails to come from. In `example@company.com`, this command specifies `company`.
+
[source,bash]
----
 $ tscli smtp set-mailname <mailname>
----

. Specify the name of the email address you would like emails to come from. In `example@company.com`, this command specifies `example`.
+
[source,bash]
----
 $ tscli smtp set-mailfromname <mailfromname>
----

=== Configure SMTP authentication

. Log in to the Linux shell using SSH.

. If SMTP authentication is required, you must specify a username and password. Skip this step if SMTP authentication is not required.
+
[source,bash]
----
 $ tscli smtp set-saslcredentials
----

[#configure-email]
=== Configure an email to receive alerts

ThoughtSpot sends alerts to the email address specified during installation.
If you do not specify an email address, you do not receive any alerts.
To add an email to receive alerts, issue the following command.

NOTE: Add the ThoughtSpot Support alert email, `prod-alerts@thoughtspot.com`, to allow ThoughtSpot Support to receive alerts.
ThoughtSpot Support monitors these alerts to ensure your cluster's health.
Do not add this email to POC or demo environments.

[source,bash]
----
$ tscli monitoring set-config --email
     <prod-alerts@thoughtspot.com>,
     <your_email>
----

To send to multiple emails, provide a comma-separated list with no spaces.

[#verify-email]
=== Verify the relay with an email

Check if the email settings are working properly by using this procedure.

. Log in to the Linux shell using SSH.
. Try sending an email to yourself by issuing:
+
[source,bash]
----
$ echo | mail -s Hello <your_email>
----

. If you receive the email at the address(es) you supplied, email is working correctly.

[#admin-portal]
include::partial$smtp-configure.adoc[]

After you configure SMTP through the Admin Console, use `tscli` to <<configure-email,configure an email to receive monitoring alerts>> and <<verify-email,verify the relay with an email>>.
