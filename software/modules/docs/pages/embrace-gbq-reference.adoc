= BigQuery connection reference
:experimental:
:linkattrs:

Learn about the fields used to create a BigQuery connection using ThoughtSpot Embrace.

Here is a list of the fields of a BigQuery connection in ThoughtSpot Embrace.
You need specific information to establish a seamless and secure connection.
All fields are required, except where noted.

Connection name:: Enter a new BigQuery connection name.
Connection description:: Provide a short description of the connection. _(Optional)_
Project id:: Enter the project ID associated with the BigQuery database.
Service account:: Enter the service account associated with the BigQuery database.

[#custom-role]
== Create a custom role

In order to use ThoughtSpot Embrace to query your GBQ database, you must create a custom role with specific permissions and then assign it to  your service account.

. Navigate to https://console.cloud.google.com[console.cloud.google.com,window=_blank], sign in, and select your project.
. Hover over *IAM & admin*.
. Click *Roles*.
. Click *+CREATE ROLE*.
. On the Create Role page, do the following:
 ** Enter a title (or keep the existing one).
 ** (Optional) Enter a description.
 ** Create an ID (or keep the existing one).
 ** Select a Role launch stage.
 ** Click *+ADD PERMISSIONS*.
. In the Add permissions window, select the following permissions:
 ** bigquery.config.get
 ** bigquery.datasets.getIamPolicy
 ** bigquery.jobs.create
 ** bigquery.jobs.list
 ** bigquery.savedqueries.get
 ** bigquery.savedqueries.list
 ** bigquery.tables.get
 ** bigquery.tables.getData
 ** bigquery.tables.list
 ** resourcemanager.projects.get

+
image::gbq-role-permissions.png[]
. Click *ADD*.
. Click *CREATE*.

[#service-account]
== Set up service account

You may already have a service account for GBQ with the proper permissions in place.
If not, follow these steps to create a service account.

. Navigate to https://console.cloud.google.com[console.cloud.google.com,window=_blank], sign in, and select your project.
. Click the navigation menu in the upper left, if it is not already open.
. Hover over *IAM & Admin*.
. Click *Service Accounts*.
+
image::gbq-serviceaccount.png[Click Service Accounts]

. Click *+ CREATE SERVICE ACCOUNT* from the top menu.
. Specify a name, and add an optional description.
. Click *CREATE*.
+
image::gcp-createserviceaccount.png[Create your service account]

. On the Service account permissions page, click *Select a role*, choose *Custom*, and select the custom role you created in <<custom-role,Create a custom role>>.
// [Specify permissions](gbq-serviceaccountpermissions.png "Specify permissions")
. Click *CONTINUE*.
. On the Create service account page, click *+ CREATE KEY*.
. For *Key type*, choose *JSON*.
. Click *CREATE*.
The key downloads to your computer.
+ When the download is complete, the message: "Private key saved to your computer" appears.
. Make note of the name of the filename, so you can find it on your computer, and then click *CLOSE*.
. When you are ready to add a connection to BigQuery in ThoughtSpot, open the private key file in a text editor, and copy the entire contents of the file.
image:gbq-key-copy.png[]
. In the connection details page of your BigQuery connection in ThoughtSpot, paste this key into the *Service account* field.
+ For details on how to add a connection to BigQuery in ThoughtSpot, see xref:embrace-gbq-add.adoc[Add a BigQuery connection].

[#share-dataset]
== Share dataset

To make your dataset available for your Google BigQuery connection in ThoughtSpot, you must share it with your service account in Google BigQuery in an owner role.

. Navigate to https://console.cloud.google.com[console.cloud.google.com,window=_blank], sign in, and select your project.
. Click the navigation menu in the upper left, if it is not already open.
. Scroll down in the navigation menu into the BIG DATA section, and click *BigQuery*.
+ Your project should be listed on the left side of the page under the search box.
. Click your project to reveal its available datasets.
. Click the dataset that you want to share.
. Click *SHARE DATASET*.
. Click *Owner* to reveal the complete list of project owners.
. In the Add members box, enter the member email address of the service account you want to share the dataset with.
. Click *Select a role*, select menu:Project[Owner], and click *Add*.
. Click *Done*.
