= Configure OAuth for a Google BigQuery connection
:last_updated: 2/23/2023
:author: Naomi
:linkattrs:
:experimental:
:page-layout: default-cloud
:description: Learn how to configure OAuth for Google BigQuery.
:connection: BigQuery
:jira: SCAL-160062

Learn how to configure OAuth in your Google Cloud project. In order to use the OAuth authentication type for a Google {connection} connection in ThoughtSpot, you must complete these steps. These steps are a representative example that serve as a guide to set up OAuth credentials in your Google Cloud project. For more information, refer to the official Google documentation links provided at the end of this article.

IMPORTANT: Each ThoughtSpot instance requires a unique {connection} security integration.
Each user in {connection} must have a default warehouse and default role.

The following sections describe how to <<configure-consent-screen,configure an OAuth consent screen>> and <<generate-credentials,generate OAuth credentials>>. If you've already configured an OAuth consent screen for another application in your project, you won't need to create another; you configure only one consent screen for all applications in a project.

NOTE: For more information about configuring the Google OAuth consent screen, see the link:https://support.google.com/cloud/answer/6158849#userconsent&zippy=%2Cuser-consent[Google Support documentation].

[#configure-consent-screen]
== Configure an OAuth consent screen

. Sign in to your Google Cloud project.

. In the left menu, select *APIs & Services* and click *OAuth consent screen*.
+
image:oauth-consent-screen.png[Select OAuth consent screen]

. For User Type, select *External*, and click *Create*.
+
image:oauth-consent-screen-dialog.png[Select External for User type]

. Google displays the *OAuth consent screen* page. Fill out the fields as follows:

.. For *App name*, enter the name of the application. In this case, the name is ThoughtSpot_GBQ.
.. For *User support email*, enter the support email that users should contact with login or consent issues.
+
image:edit-app-registration.png[Consent screen page]

.. Click *+ ADD DOMAIN* to reveal the *Authorized domain 1* field. In this field, enter the domain of the URL to your ThoughtSpot instance. For example, if ThoughtSpot hosts your instance at `+https://<instance_name>.thoughtspot.cloud+`, the domain is `thoughtspot.cloud.com`.
+
image:authorized-domains.png[Add authorized domain]

.. In the *Developer contact information* section, enter one or more emails addresses that Google can use to contact you about your project. The remaining fields are optional, but you can use them to further customize your consent screen.
+
image:developer-contact-info.png[Developer email]

. Click *SAVE AND CONTINUE*.

. Google displays the *Scopes* page. You can add scopes as shown in the following image. Click *SAVE AND CONTINUE*.
+
image:edit-app-registration-scopes.png[Add scopes]

. The scope selected in the following image is sufficient to create a connection and view data in {connection}.
+
`\https://www.googleapis.com/auth/bigquery.readonly`
+
image:update-selected-scopes.png[Update selected scopes]

. On the *Summary* page, click *BACK TO DASHBOARD*.

[#generate-credentials]
== Generate Google OAuth credentials

. Go to the link:https://console.cloud.google.com/[Google Cloud console].

. In the left menu, select the *APIs & Services* page. Then click *Credentials*.
+
image:credentials.png[Credentials]

. On the *Credentials* page, click the down arrow in the *Create credentials* button, and select *OAuth client ID* from the dropdown menu.
+
image:create-credentials.png[OAuth client ID]

. If you've already configured an OAuth consent screen, Google displays the *Create OAuth client ID* page, which lets you create and OAuth client ID and client secret to use in your Google {connection} connection in ThoughtSpot.

. From the *Application type* dropdown, select *Web application*. The page expands to display additional options.
+
image:client-id-application.png[Select web application as application type]
+
image:create-oauth-client-id.png[Fields to create an OAuth client ID]

.. For *Name*, enter a name for the app, such as ConnectionsOAuth.

.. The *Authorized Javascript origins* section is optional, unless you are redirecting using javascript.

.. For *Authorized redirect URIS*, click *+ ADD URI* to display the *URIs 1* field. For *URIs 1*, enter the URL to your ThoughtSpot instance, followed by `/callosum/v1/connection/generateTokens`. +
For example, +
`\https://thoughtspot.cloud/callosum/v1/connection/generateTokens`.
+
image:authorized-redirect-uri.png[Authorized redirect URI]

. Click *Create*. Google displays your *Client ID* and your *Client Secret* in a pop-up dialog box.
+
image:client-id-client-secret.png[Client ID and Client secret]

. Copy your client ID and your client secret values. You will need them to configure OAuth for the {connection} connection in ThoughtSpot.

== Logging in to a connection created by another user using OAuth

As an admin user, you may run into an issue logging in to connections created using OAuth. To resolve this issue, complete the following steps:

. Search on a table belonging to the connection you are trying to edit. The following error appears:
+
image:oauth-error.png[Error reading “Error in loading data. Connection to Snowflake could not be established. OAuth login required. Login”]

. Click *Login*. You will be directed to the IDP login page.

. Enter your login credentials.

. You will now have access to edit the connection.

=== References

* link:https://cloud.google.com/looker/docs/db-config-google-bigquery#configuring_an_oauth_consent_screen[Configuring an OAuth consent screen]
* link:https://cloud.google.com/looker/docs/db-config-google-bigquery#generating_google_oauth_credentials[Generating Google OAuth credentials]
* link:https://developers.google.com/identity/protocols/oauth2/scopes[OAuth 2.0 Scopes for Google APIs]

== OAuth connection improvements

If you do not have a valid OAuth access token, you can now directly navigate to the OAuth authorization screen when performing one of the following actions on a connection shared with you:

** View sample data
** Create a custom SQL view
** Edit the connection


'''
> **Related information**
>
> * xref:connections-gbq-prerequisites.adoc[{connection} prerequisites]
> * xref:connections-gbq-ingress.adoc[]
> * xref:connections-gbq-add.adoc[Add a {connection} connection]
> * xref:connections-gbq-edit.adoc[Edit a {connection} connection]
> * xref:connections-gbq-remap.adoc[Remap a {connection} connection]
> * xref:connections-gbq-external-tables.adoc[Query external tables from your {connection} connection]
> * xref:connections-gbq-delete-table.adoc[Delete a table from a {connection} connection]
> * xref:connections-gbq-delete-table-dependencies.adoc[Delete a table with dependent objects]
> * xref:connections-gbq-delete.adoc[Delete a {connection} connection]
> * xref:connections-gbq-reference.adoc[Connection reference for {connection}]
//> * xref:connections-query-tags.adoc#tag-gbq[ThoughtSpot query tags in Google BigQuery]
> * xref:connections-gbq-passthrough.adoc[]
> * xref:connections-column-indexing-oauth.adoc[]
