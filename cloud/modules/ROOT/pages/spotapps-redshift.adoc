= {spotapp}
:last_updated: 6/13/2022
:experimental:
:linkattrs:
:page-layout: default-cloud
:description: Deploy the Redshift Performance and Consumption SpotApp, an out-of-the-box solution template built specifically for Redshift.
:spotapp: Redshift Performance and Consumption SpotApp
:application: Redshift

include::partial$spotapps-intro.adoc[]

This is a sample Liveboard, created after you deploy the {spotapp}:

image::spotapp-redshift-liveboard.png[Redshift SpotApp Liveboard]

Use the {spotapp} to manage costs and investigate query performance. Track how and where your users consume credits, and triage and resolve any performance bottlenecks.

[#prerequisites]
== Prerequisites
Before you can deploy the {spotapp}, you must complete the following prerequisites:

* Review the <<schema,required tables and columns>> for the SpotApp.
* Ensure that your columns match the required column type listed in the schema for your SpotApp.
* Sync all tables and columns from {application} to your cloud data warehouse. You can sync only the required tables and columns, but ThoughtSpot recommends syncing all tables and columns from {application} to your CDW. The columns can be {application}'s out-of-the-box columns, or any custom columns that you are using instead of the out-of-the-box columns.
+
NOTE: If you are using an ETL/ELT tool or working with another team in your organization to move data, our recommendation is that you sync *_all_* columns from the tables listed in the SpotApp.
* Obtain credentials and *SYSADMIN* privileges to connect to {application}. The cloud data warehouse must contain the data you would like ThoughtSpot to use to create Answers, Liveboards, and Worksheets. Refer to the xref:connections-redshift-reference.adoc[Connection reference] for {application} for information about required credentials.
* The connection name for each new SpotApp must be unique.
* Administrator access to {application}
* You must create views based on the following {application} tables in your cloud data warehouse. If you already created the views, you only need access to the views, not the tables. Refer to <<schema,{spotapp} schema>> for more details.
** pg_user
** stl_query
** stl_wlm_query
** stv_wlm_service_class_config
** svl_qlog
** stl_alert_event_log
** svv_table_info
** stv_sessions
** stl_load_errors
** stv_node_storage_capacity
** stl_ddltext
** stl_plan_info
** svl_query_metrics_summary
** svl_s3query_summary

* Access to the following {application} views in your cloud data warehouse:
** pg_user_vw
** stl_query_vw
** stl_wlm_query_vw
** stv_wlm_service_class_config_vw
** svl_qlog_vw
** stl_alert_event_log_vw
** svv_table_info_vw
** stv_sessions_vw
** stl_load_errors_vw
** stv_node_storage_capacity_vw
** stl_ddltext_vw
** stl_plan_info_vw
** svl_query_metrics_summary_vw
** svl_s3query_summary_vw
* Run the required SQL commands in your cloud data warehouse. Refer to <<sql,Run SQL commands>>.

[#sql]
=== Run SQL commands
The following SQL commands create the required views based on the required tables.

NOTE: The following SQL example is for the Redshift cloud data warehouse. You may need to modify the code for the SQL requirements of your specific cloud data warehouse.

SQL commands:
[%collapsible]
.Open the dropdown menu to view the SQL commands.
====
--
include::partial$redshift-sql-script.adoc[]
--
====

include::partial$spotapp-deploy-individual.adoc[]

== Review formula values
After you deploy the {spotapp}, you must review the default formula values ThoughtSpot used in several formulas in the *Amazon Redshift Clusters* Worksheet. Your values may be different from the default values ThoughtSpot used in the formulas. To ensure the {spotapp} is as useful for your specific data as possible, review the values in the following formulas in the *Amazon Redshift Clusters* Worksheet.

All currency values are in USD. If necessary, convert them to your currency.

* `instance type`: By default, this is set to `dc2.large`. If necessary, replace this value with the node/instance type for your Redshift cluster and region.

* `Price Per Node Per Hour (Currency)`: If necessary, replace this value with the value for your node type and region. Refer to "On-demand pricing" in the https://aws.amazon.com/redshift/pricing/[Redshift pricing documentation^].

* `Spectrum Price Per TB (Currency)`: If necessary, replace this value with the value for your region. Refer to "Amazon Redshift Spectrum pricing" in the https://aws.amazon.com/redshift/pricing/[Redshift pricing documentation^].

* `Concurrency Price per Second (Currency)`: If necessary, replace this value with the value for your region. Refer to "Concurrency Scaling Pricing" in the https://aws.amazon.com/redshift/pricing/[Redshift pricing documentation^].

[#schema]
== {spotapp} schema

The following table describes the schema for the {spotapp}.

|===
| Table/View | Column | Column type | Required column

| pg_user_vw| usename | varchar | Y
| pg_user_vw| usesuper| bool| N
| pg_user_vw| usesysid| int | Y
| stl_query_vw| query | int | Y
| stl_query_vw| pid | int | Y
| stl_query_vw| database| varchar | Y
| stl_query_vw| querytxt| varchar | Y
| stl_query_vw| starttime | timestamp | N
| stl_query_vw| endtime | timestamp | N
| stl_query_vw| aborted | int | N
| stl_query_vw| userid| int | N
| stl_wlm_query_vw| query | int | Y
| stl_wlm_query_vw| service_class | int | Y
| stv_wlm_service_class_config_vw | name| varchar | Y
| stv_wlm_service_class_config_vw | service_class | int | Y
| svl_qlog_vw | elapsed | int | Y
| svl_qlog_vw | query | int | Y
| stl_alert_event_log_vw| query | int | Y
| stl_alert_event_log_vw| event | varchar | Y
| stl_alert_event_log_vw| solution| varchar | N
| stl_alert_event_log_vw| pid | int | N
| stl_alert_event_log_vw| event_time| timestamp | N
| svv_table_info_vw | database| varchar | N
| svv_table_info_vw | table | varchar | Y
| svv_table_info_vw | size| int | N
| svv_table_info_vw | pct_used| numeric | N
| svv_table_info_vw | tbl_rows| numeric | Y
| stv_sessions_vw | starttime | timestamp | Y
| stv_sessions_vw | process | int | Y
| stv_sessions_vw | db_name | varchar | N
| stv_sessions_vw | timeout_sec | int | N
| stv_sessions_vw | user_name | varchar | Y
| stl_load_errors_vw| query | int | Y
| stl_load_errors_vw| line_number | int | N
| stl_load_errors_vw| session | int | N
| stl_load_errors_vw| colname | varchar | N
| stl_load_errors_vw| starttime | timestamp | N
| stl_load_errors_vw| tbl | int | N
| stl_load_errors_vw| filename| varchar | N
| stl_load_errors_vw| err_code| int | N
| stl_load_errors_vw| err_reason| varchar | Y
| stl_load_errors_vw| userid| int | Y
| stv_node_storage_capacity_vw| capacity| int | Y
| stv_node_storage_capacity_vw| used| int | Y
| stv_node_storage_capacity_vw| node| int | Y
| stl_ddltext_vw| pid | int | Y
| stl_plan_info_vw| nodeid| int | Y
| stl_plan_info_vw| query | int | Y
| svl_query_metrics_summary_vw| query | int | Y
| svl_s3query_summary_vw| query | int | Y

|===
