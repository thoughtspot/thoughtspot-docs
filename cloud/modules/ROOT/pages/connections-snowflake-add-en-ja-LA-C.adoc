= {connection} 接続を追加します。
:last_updated: 2024年10月08日
:linkattrs:
:page-layout: default-cloud
:experimental:
:connection: Snowflake
:description: Snowflake接続を追加する方法を学びましょう。
:jira: SCAL-91104、SCAL-196178、SCAL-136317（スノーフレークの複数の設定）

== 前提条件

{connection} 接続を追加する前に、使用されているアカウントのデフォルトロール、または接続で指定したロールがデータベースとスキーマで使用が許可されていることを確認し、接続に追加するテーブルを選択してください。

例：

* ウェアハウス `<warehousename>` の使用権をロール `<rolename>` に付与します。
* データベース `<databasename>` の使用権をロール `<rolename>` に付与します。
* スキーマ `<databasename>`.`<schemaname>` の使用権をロール `<rolename>` に付与します。
* スキーマ `<databasename>`.`<schemaname>` 内のすべてのテーブルに対するSELECT権限をロール `<rolename>` に付与します。

== {connection} に接続します

{connection} に接続するには:


. 上部のナビゲーションバーで*データ*を選択します。
. 左側のナビゲーションバーで *Connections* タブを開き、{connection} タイルを選択します。または、左側のナビゲーションバーで *+新規作成* を選択し、*接続* を選択して、{connection} タイルを選択します。
. 接続の名前と説明（オプション）を作成し、*続ける*を選択します。
+
image::embrace-snowflake-connection-type-ts-cloud.png[{connection} 接続を追加]を選択します

. {connection} データソースの接続詳細を、OAuth、PKCE を使用した OAuth、Microsoft Azure AD OAuth、サービスアカウント、またはキーペア認証のいずれかを使用して入力します:
+
[OAuth を使用] オプションでは、https://docs.snowflake.com/en/user-guide/oauth-partner.html[{connection} OAuth 認証^]を使用します。
+
*OAuth を使用する* または *PKCE を使用した OAuth* 認証を選択する前に、{connection} で OAuth を設定する必要があります。
詳細については、xref:connections-snowflake-oauth.adoc[{connection} 接続のための OAuth の設定方法]をご覧ください。
+
*外部 OAuth を使用する* 認証を選択する前に、Azure AD または Okta の外部 OAuth を設定する必要があります。
詳細については、xref:connections-snowflake-azure-ad-oauth.adoc[Azure AD 外部 OAuth の {connection} 接続の設定] または xref:connections-snowflake-okta-oauth.adoc[Okta 外部 OAuth の {connection} 接続の設定] をご覧ください。
+
- OAuth 認証の場合は、次の操作を行ってください。

 .. *OAuth* を選択します。
 .. アカウント名、あるいはあなたの{connection} URL、OAuth クライアントID、OAuth クライアントシークレット、データベース（任意）、ロール（任意）、ウェアハウス（任意）を入力してください。image:snowflake-connectiondetails-oauth2.png[接続詳細を入力]してください。
// [Enter connection details]({{ site.baseurl }}/images/gbq-connectiondetails.png "Enter connection details")
 .. {connection}接続に対してオプションの追加キーと値のペアを提供したい場合は、手順5を完了し、その後*続ける*を選択してください。
そうでない場合は、*続ける*を選択してください。
 .. {connection}のログイン画面が表示されたら、あなたの{connection}ユーザー名とパスワードを入力し、*ログイン*を選択するか、シングルサインオンオプションを使用してください。
 .. 次の{connection}画面では、ThoughtSpotがあなたの{connection}アカウントにアクセスできるように*許可*を選択し、その後ステップ7に進んで接続用のテーブルを選択してください。
+
セキュリティパススルーの使用は、行レベルのセキュリティに影響を及ぼす可能性がありますのでご注意ください。
xref:security-rls.adoc[行レベルのセキュリティ (RLS) について]の詳細は、こちらをご覧ください。

+
- Microsoft Azure ADまたはOkta OAuth認証を使用する場合は、次の手順を実行してください。

 .. *外部 OAuth<1>}を選択してください。
 .. アカウント名、{connection} URL、OAuth クライアント ID、OAuth クライアント シークレット、スコープ、認証 URL、アクセス トークン URL、そして（オプションで）データベースを入力してください。image:snowflake-connectiondetails-azure-ad-oauth.png[接続詳細を入力]します。
// [Enter connection details]({{ site.baseurl }}/images/gbq-connectiondetails.png "Enter connection details")
 .. オプションで追加のキーと値のペアを提供したい場合は、{connection}接続の手順5を完了した後、*続ける*を選択してください。
そうでない場合は、*続ける*を選択してください。
.. link:https://docs.snowflake.com/en/user-guide/security-access-control-overview#enforcement-model-with-primary-role-and-secondary-roles[Snowflakeのセカンダリロール^]を有効にするためには、次のキーと値のペアを入力してください。
[#secondary]
... キー: enableSecondaryRoles
... 値: true
 .. Microsoftのサインイン画面が表示された際には、Azureに関連付けられたMicrosoftアカウントのメールアドレスとパスワードを用いて、アカウントへのサインインを行ってください。
 .. [サインインしたままにする]の画面にて、*はい*を選択してください。

+
- *サービスアカウント*の認証を行うためには、以下の手順を実行してください。

 .. *サービスアカウント*を選択してください。
 .. アカウント名、ユーザー、パスワード、ロール、ウェアハウス、そして（任意）データベースを入力してください。image:snowflake-connectiondetails-serv-acct2.png[接続詳細を入力]してください。

+
- *キーペア*の認証を行うためには、以下の手順を実行してください。

.. *キーペア*を選択してください。
.. アカウント名またはSnowflakeのURL、ユーザー、秘密鍵、（任意）パスフレーズ、ロール、ウェアハウス、そして（任意）データベースを入力してください。image:snowflake-key-pair.png[接続詳細を入力]してください。

+
接続に入力する必要がある各属性の詳細については、xref:connections-snowflake-reference.adoc[{connection} 接続リファレンス] を参照してください。
+
. (オプション) {connection} 接続のプロキシを次の手順で構成します: ..*詳細設定* メニューを選択して、[キー]フィールドと[値]フィールドを表示します。[Key] に *useProxy* を入力し、[Value] に *true* を入力します。
..プラス記号(+)を選択して、追加のキーと値のフィールドを追加します。[Key] に *proxyHost* を入力し、[Value] にプロキシサーバーの URL を入力します。プラス記号(+)を選択して、追加のキーと値のフィールドを追加します。[Key] に *proxyPort* を入力し、[Value] にプロキシポート番号を入力します。
+
[IMPORTANT]
.{connection} 共有プロキシの制限
====
{connection} は最初の接続からプロキシ設定を使用し、その設定を*すべての*接続に再利用します。

{connection} でプロキシを設定する場合、次のことを確認してください。

- 異なるプロキシを使用する他の接続や、プロキシを使用しない接続がないことを確認してください。
- 新しい各接続に同じプロキシの詳細があることを確認してください。プロキシを使用せずにメタデータの取得に失敗した場合、後からプロキシを追加しても機能しないかもしれません。なぜなら、{connection} ドライバーはプロキシがないと想定しているかもしれないからです。
====
. (オプション) {connection} への接続を設定するために必要な追加のキーと値のペアを指定するか、{connection} がサポートする追加の JDBC パラメータをカスタマイズするには、次の手順を実行します:
 .. *詳細設定* メニューを選択して、*キー* と *値* フィールドを表示します。
 .. キーと値の情報を入力してください。例えば、一つの接続で複数の{connection}データベースにアクセスしたいけれども、その接続で_全ての_Snowflakeデータベースにアクセスしたくない場合、ここでそれを指定することができます。アクセスしたい特定のデータベースごとに、`database`をキーとし、データベース名を値として設定してください。https://docs.snowflake.com/en/user-guide/jdbc-parameters.html[Snowflake JDBCのドキュメンテーション^]をご参照ください。
 .. キーと値をさらに追加するには、プラス記号 (+) を選択し、それらを入力してください。

+
NOTE: 入力するキーと値のペアは、{connection}データソースで定義されている必要があります。
キーと値のペアは、大文字と小文字を区別します。
. *続ける*を選択してください。
. テーブル（左側）と各テーブルの列（右側）を選択し、その後*接続を作成*を選択してください。
+
image::snowflake-selecttables.png[接続のためのテーブルと列を選択してください]
+
[接続の作成] メッセージが表示され、接続に追加されるテーブルと列の数が表示されます。

. *作成* を選択してください。

== 接続の共有

*データを管理できる* または *管理者* 権限を持つユーザーは、*データを管理できる* 権限を持つ他のユーザーやグループと接続を共有できます。接続へのアクセス権が付与されると、ユーザーはその接続でテーブルを追加、削除、および変更できます。

他のユーザーと接続を共有するには、次の手順に従ってください。

. *データ* タブに移動し、*接続* を選択してください。

. 共有したい接続の名前の隣にあるチェックボックスを選択し、*共有*をクリックしてください。

. *接続の共有* ダイアログで、接続を共有したいユーザーまたはグループのIDを入力してください。検索バーを使用して、ユーザーまたはグループを検索できます。

. *完了*を選択します。

接続から共有アクセスを削除するには、*接続の共有*ダイアログに移動し、ユーザーグループまたは名前の左側にある*アクセス権の削除*を選択します。

[#additional-configurations-create]
== {connection} 接続のための追加設定を作成します。

{connection} 接続を作成する際に、デフォルト設定を入力します。{connection} 接続のための追加設定を作成することができます。追加設定を行うことで、以下の操作が可能となります：

- 特定のThoughtSpotユーザーやグループに対して別のSnowflakeウェアハウスを設定することで、Liveboardsを複製したり、複数のSnowflake接続を設定する必要がなくなります。これにより、コストの追跡とチャージバックを助けることができます。
- 検索インデックス作成には、Snowflakeウェアハウスなどの別の構成を使用して、コンピューティング負荷を制御し、バランスを取るようにしてください。
- さまざまな環境（開発、QA、本番）に対して一連のLiveboardをテストし、マルチテナント/マルチオーグデプロイ用にさまざまなSnowflakeウェアハウスを構成してください。

.[.badge.badge-早期アクセス]#早期アクセス#
****
{connection} 接続の追加設定を作成する機能は早期アクセス機能であり、デフォルトでは無効になっています。有効にするには、ThoughtSpotの管理者にお問い合わせください。早期アクセス機能の詳細については、xref:release-lifecycle.adoc#early-access[ThoughtSpot Cloudリリースのライフサイクル]をご覧ください。
****

=== {connection} 接続の追加構成を作成してください。

{connection} 接続の追加設定を作成するには、次の手順を実行します。

. 上部のナビゲーションバーで*データ*を選択します。
. 左側のナビゲーションバーで*Connections*タブを開いてください。
. 接続のリストから、設定を追加したい接続を探してください。
. 接続の右端にある [その他] メニュー image:icon-more-10px.png[その他のメニュー]をクリックし、 *設定の作成*を選択してください。
. _設定の詳細を追加する_ ウィンドウで、以下を指定してください。
.. 認証タイプ
.. ユーザー
.. パスワード
.. 役割
.. データウェアハウス
.. (オプション)高度な設定
. *続ける* をクリックしてください。
+
認証タイプによっては、Snowflakeアカウントにサインインする必要があるかもしれません。
. (オプション)Snowflakeのサインイン画面が表示された場合は、Snowflakeにサインインしてください。次に、Snowflakeアカウントへの接続アクセスを許可するように求めるメッセージが表示されたら、*許可*をクリックしてください。

+
接続はThoughtSpotによって検証され、その後、 _構成の説明_ ウィンドウが表示されます。
. 設定の名前と（任意で）説明を作成し、*続行*をクリックしてください。
. _ポリシーの種類を選択_ ウィンドウで、次のオプションから選択してください。
ポリシーなし::
設定を保存したいが、まだ接続にポリシーを適用したくない場合は、これを選択してください。
ユーザーとグループ::
接続を使用できるユーザーとグループを指定したい場合は、これを選択してください。
プロセス::
この設定を検索インデックス作成に使用したい場合は、これを選択してください。*セージインデックス*がチェックされていることを確認してください。
. *続ける*をクリックしてください。
+
追加の設定が完了し、接続ページの接続名の下に表示されます。
+
image::snowflake_multi_conn2.png[Snowflakeの設定]

NOTE: グレー表示されている設定は、現在無効です。

.行数接続設定 [.badge.badge-early-access-whats-new]#早期アクセス#
****
接続を作成する際に、異なる設定を割り当てることができます。行数の統計を実行するための接続を作成し、他のプロセスやユーザークエリから分離してください。この機能を使用すると、ユーザーおよびプロセスごとのクラウドデータウェアハウスの使用状況の監査と追跡に役立ちます。適切なリソースを適切なプロセスとユーザーに割り当てることで、コストを最適化します。

この機能を有効にするには、管理者にお問い合わせください。
****


追加の設定は、作成後に編集、無効化、削除などができます。詳細については、xref:connections-snowflake-edit.adoc#edit-additional-connections[{connection} 接続の追加接続を編集する]をご覧ください。

'''
> **関連情報**
>
> * xref:connections-snowflake-edit.adoc[{connection} 接続を編集する]
> * xref:connections-snowflake-remap.adoc[{connection} 接続をリマップする]
> * xref:connections-snowflake-external-tables.adoc[{connection} 接続から外部テーブルをクエリする]
> * xref:connections-snowflake-delete-table.adoc[{connection} 接続からテーブルを削除する]
> * xref:connections-snowflake-delete-table-dependencies.adoc[従属オブジェクトを含むテーブルを削除する]
> * xref:connections-snowflake-delete.adoc[{connection} 接続を削除する]
> * xref:connections-snowflake-oauth.adoc[OAuth を構成する]
> * xref:connections-snowflake-azure-ad-oauth.adoc[Azure AD OAuth を構成する]
> * xref:connections-snowflake-best.adoc[{connection}接続のベストプラクティス]
> * xref:connections-snowflake-private-link.adoc[]
> * xref:connections-snowflake-psc.adoc[]
> * xref:connections-snowflake-reference.adoc[接続参照 {connection}]
> * xref:connections-query-tags.adoc#tag-snowflake[SnowflakeにおけるThoughtSpotのクエリタグ]
> * xref:connections-snowflake-passthrough.adoc[]
