= Configure OAuth for a {connection} connection
:experimental:
:last_updated: 6/17/2022
:linkattrs:
:page-layout: default-cloud
:connection: Dremio
:description: How to configure OAuth for a Dremio connection in ThoughtSpot

ThoughtSpot supports OAuth for a {connection} connection.

To configure OAuth for {connection}, you create an app in the Identity Provider and use the appâ€™s credentials to register it in {connection} as an external token provider. When you complete these steps, {connection} allows connections with JWT issued by the IdP.

[#part-1]
== Part 1: Configuring the IdP with Okta

The following steps detail the configuration of IdP with Okta as an example. You can set up any other OpenID Connect (OIDC)-based IdP providers following a similar process. For details, refer to the respective documentation for those.

To configure the IdP with Okta, do the following:

. Log in to the Okta console with a user having administrator privileges. Navigate to the *Applications* page in the console and click *Create App Integration*.
+
image::dremio-oauth1.png[]
+
. For sign-in method, choose *OIDC - OpenID Connect*.
. For application type, choose *Web Application*
. Click *Next*.
. Under Grant type, make sure *Authorization Code* is selected.
+
image::dremio-oauth2.png[]

. For Sign-in redirect URIs, add the ThoughtSpot redirect URI for the application.
+
It should follow this format:
+
`\https://<your-thoughtspot-instance-host>/callosum/v1/connection/generateTokens`
+
image::dremio-oauth3.png[]

. Assign the application to everyone in the organization or to specific groups. This step may vary for other IdPs.
+
image::dremio-oauth4.png[]
. Collect the client credentials from the application home page and make a note of them. These will be required later for adding the external token provider in {connection}.
+
image::dremio-oauth5.png[]
. Go to menu:Security[API], and make a note of the value for Audience. This is required in a later step
for configuring the OpenID well-known URI for the authorization server.
+
image::dremio-oauth6.png[]
+
For Okta, it should follow this format:
+
`\https://<organization>.okta..com/oauth2/<unique_id>/.well-known/oauth-authorization-server`
. Open the URL in a browser and make a note of the values for the following parameters:
- Issuer
- Authorization endpoint
- JWKS URI
- Token endpoint

[#part-2]
=== Part 2: Adding an external token provider in {connection}

To add an external token provider in {connection}, do the following:

. Log in to the {connection} cloud console and navigate to Organization Settings.
. From the menu, click *External Token Providers*.
. Click *Add Provider*, and add the details of your IdP.
+
image::dremio-oauth7.png[]
+
For User Claim Mapping, use the value of the claim in the JWT issued by the IdP that contains the value of the username in {connection}.
+
Example token generated by Okta:
+
image::dremio-oauth8.png[]

[#part-3]
=== JDBC Connection URL

Connection string for JDBC should include the token string for password parameter with username left empty.

Example connection string:
----
"jdbc:dremio:direct=sql.dremio.cloud:443;ssl=true;PROJECT_ID=732b5f6d-d2f6-4d3d-b3b6-0dc68bc778f5;token_type=jwt;password=<access_token_from_IdP>;username=;";
----
'''
> **Related information**
>
> * https://docs.dremio.com/cloud/security/authentication/external-token/[External Token Providers^] (Dremio documentation)
> * xref:connections-dremio-add.adoc[Add a {connection} connection]
> * xref:connections-dremio-edit.adoc[Edit a {connection} connection]
> * xref:connections-dremio-remap.adoc[Remap a {connection} connection]
> * xref:connections-dremio-delete-table.adoc[Delete a table from a {connection} connection]
> * xref:connections-dremio-delete-table-dependencies.adoc[Delete a table with dependent objects]
> * xref:connections-dremio-delete.adoc[Delete a {connection} connection]
> * xref:connections-dremio-reference.adoc[Connection reference for {connection}]
