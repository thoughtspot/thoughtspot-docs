= {connection} prerequisites
:last_updated: 9/21/2020
:linkattrs:
:page-layout: default-cloud
:page-aliases: /admin/ts-cloud/ts-cloud-embrace-gbq-prerequisites.adoc
:experimental:
:connection: BigQuery
:description: To use a ThoughtSpot connection to query your GBQ database, create a custom role with specific permissions and then assign it to  your service account.

To use a ThoughtSpot connection to query your GBQ database, you must create a custom role with specific permissions and then assign it to  your service account.

[#custom-role]
== Create a custom role

To create a custom role in {connection}, do the following:

. Navigate to https://console.cloud.google.com[console.cloud.google.com^], sign in, and select your project.
. Hover over *IAM & admin*.
. Click *Roles*.
. Click *+CREATE ROLE*.
. On the Create Role page, do the following:
 ** Enter a title (or keep the existing one).
 ** (Optional) Enter a description.
 ** Create an ID (or keep the existing one).
 ** Select a Role launch stage.
 ** Click *+ADD PERMISSIONS*.
. In the Add permissions window, select *ONLY* the following permissions:
 ** bigquery.config.get
 ** bigquery.datasets.get
 ** bigquery.datasets.getIamPolicy
 ** bigquery.jobs.create
 ** bigquery.jobs.list
 ** bigquery.readsessions.create
 ** bigquery.savedqueries.get
 ** bigquery.savedqueries.list
 ** bigquery.tables.get
 ** bigquery.tables.getData
 ** bigquery.tables.list
 ** resourcemanager.projects.get

+
image::gbq-role-permissions.png[Select only the permissions listed]
. Click *ADD*.
. Click *CREATE*.

[#service-account]
== Set up service account

You may already have a service account for GBQ with the proper permissions in place.
If not, follow these steps to create a service account.

. Navigate to https://console.cloud.google.com[console.cloud.google.com^], sign in, and select your project.
. Click the navigation menu in the upper left, if it is not already open.
. Hover over *IAM & Admin*.
. Click *Service Accounts*.
+
image::gbq-serviceaccount.png[Click Service Accounts]

. Click *+ CREATE SERVICE ACCOUNT* from the top menu.
. Specify a name, and add an optional description.
. Click *CREATE*.
+
image::gcp-createserviceaccount.png[Create your service account]

. On the Service account permissions page, click *Select a role*, choose *Custom*, and select the custom role you created in <<custom-role,Create a custom role>>.
. Click *CONTINUE*.
. On the Create service account page, click *+ CREATE KEY*.
. For *Key type*, choose *JSON*.
. Click *CREATE*.
The key downloads to your computer.
+
When the download is complete, the message: "Private key saved to your computer" appears.
. Make note of the name of the filename, so you can find it on your computer, and then click *CLOSE*.
. When you are ready to add a connection to {connection} in ThoughtSpot, open the private key file in a text editor, and copy the entire contents of the file.
. In the connection details page of your {connection} connection in ThoughtSpot, paste this key into the *Service account* field.
+
For details on how to add a connection to {connection} in ThoughtSpot, see xref:connections-gbq-add.adoc[Add a {connection} connection].

[#share-dataset]
== Share dataset

To make your dataset available for your Google {connection} connection in ThoughtSpot, you must share it with your service account in Google {connection} in an owner role.

. Navigate to https://console.cloud.google.com[console.cloud.google.com^], sign in, and select your project.
. Click the navigation menu in the upper left, if it is not already open.
. Scroll down in the navigation menu into the BIG DATA section, and click *{connection}*.
+
Your project should be listed on the left side of the page under the search box.
. Click your project to reveal its available datasets.
. Click the dataset that you want to share.
. Click *SHARE DATASET*.
. Click *Owner* to reveal the complete list of project owners.
. In the Add members box, enter the member email address of the service account you want to share the dataset with.
. Click *Select a role*, select menu:Project[Owner], and click *Add*.
. Click *Done*.
