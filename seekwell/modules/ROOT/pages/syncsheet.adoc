= Sync data from Google Sheets to SQL
:last_updated: 8/26/2022
:author: Naomi
:linkattrs:
:experimental:
:page-layout: default-seekwell
:description: Sync data from a Google Sheet to your database using the Google Sheets Addon.

// destination

NOTE: The database user for this source will need write access to the database. If you need to add or insert rows, consider using xref:forms.adoc[ðŸ“‹ Forms] instead.

You can sync data from a Google Sheet back to your database using the
xref:google-sheets-addon.adoc[âž• Google Sheets Addon]. To get started, link:https://gsuite.google.com/marketplace/app/seekwell_postgres_mysql_snowflake_ms_sql/546600172375[install the addon,window=_blank]. Updates are triggered as soon as an edit in the Sheet is completed, so the updates write back to your database in near-real time.

video::KOrIT5jqQLI[youtube]

[#step-1]
. Create a link:https://sql.new/[new SQL block,window=_blank] with
xref:parameters.adoc[âš™ Parameters]. It's best to give the parameter the same name as the column, for example:
+
[source]
----
update dummy.users
set plan = '{{plan}}'
where email = '{{email}}'
----

. Add the form tag.
+
image:destination-sql-tags.png[SQL tags in SeekWell]

. link:https://gsuite.google.com/marketplace/app/seekwell_postgres_mysql_snowflake_ms_sql/546600172375[Launch the addon,window=_blank].

. Select the block created in <<step-1,step 1>> (you should see "Form" to the right of it).
+
image:new-sql-block.png[Select block created in Step 1]

. Select "Set up a sync" under the Run button.
+
image:sql-set-up-sync.png[Set up a sync]

. Add the range that your data is in, for example, "Sheet1!A:G". You need to include the cell range using A1 notation. Your table in Sheets needs to have headers / column names.
+
NOTE: You can only have one sync per Sheet, but you can have multiple syncs in the same spreadsheet.
+
image:sql-sync.png[Enter range under MySQL in A1 notation]

. If the table in Sheets has different column names than your parameters, specify the names under each parameter name.

. Select *Save*.

You can now test your sync by updating a value in the Sheet and confirming the write back to your database. Please link:mailto:contact@seekwell.io[let us know] if you run into any issues with this.

image:sql-sync-done.png[Test sync]

== Tips and tricks

=== Upserts

In link:https://chartio.com/resources/tutorials/how-to-insert-if-row-does-not-exist-upsert-in-mysql/[MySQL,window=_blank], Upserts (updating and inserting data at the same time) can be performed with "On Duplicate Key Update" after the Insert statement. Your table must already have a link:https://www.mysqltutorial.org/mysql-unique/[unique index,window=_blank]. When the row being inserted has a key that already exists in the table, the specified fields will be updated for that key in the database.

In this example, "id" is the unique index. When a certain id already exists in the table, its title, author and year_published will be updated instead of inserting a new row.

[source]
----
INSERT INTO books
    (id, title, author, year_published)
VALUES
    ({{id}}, '{{title}}', '{{author}}', '{{year_published}}')
ON DUPLICATE KEY UPDATE
    title = '{{title}}',
    author = '{{author}}',
    year_published = '{{year_published}}';
----

=== Handling null data

Null numbers can be cast as Signed Integers in MySQL to avoid errors:

[source]
----
CAST('{{your_param}}' AS SIGNED INTEGER)
----
